> **åšä¸»ä»‹ç»ï¼š**
> æœ¬äººä¸“æ³¨äºAndroid/java/æ•°æ®åº“/å¾®ä¿¡å°ç¨‹åºæŠ€æœ¯é¢†åŸŸçš„å¼€å‘ï¼Œä»¥åŠæœ‰å¥½å‡ å¹´çš„è®¡ç®—æœºæ¯•ä¸šè®¾è®¡æ–¹é¢çš„å®æˆ˜å¼€å‘ç»éªŒå’ŒæŠ€æœ¯ç§¯ç´¯ï¼›å°¤å…¶æ˜¯åœ¨å®‰å“ï¼ˆAndroidï¼‰çš„appçš„å¼€å‘å’Œå¾®ä¿¡å°ç¨‹åºçš„å¼€å‘ï¼Œå¾ˆæ˜¯ç†Ÿæ‚‰å’Œäº†è§£ï¼›æœ¬äººä¹Ÿæ˜¯å¤šå¹´çš„Androidå¼€å‘äººå‘˜ï¼›å¸Œæœ›æˆ‘å‘å¸ƒçš„æ­¤ç¯‡æ–‡ä»¶å¯ä»¥å¸®åŠ©åˆ°æ‚¨ï¼›
>
> ğŸ… **å¸Œæœ›æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©** ğŸ…

#### ä¸€ã€åŠŸèƒ½æ¼”ç¤º

![](./res/168885ddedf24225a60a57789596a2bf.gif)

#### äºŒã€å®ç°æ–¹å¼

å› ä¸ºå®¢æˆ·ç«¯æ˜¾ç¤ºçš„ä½ç½®æ•°æ®éƒ½æ˜¯è°ƒç”¨apiè·å–çš„ï¼›æ‰€ä»¥æˆ‘åªè¯´æ˜ä¸€ä¸‹å¯¼èˆªçš„é€»è¾‘å°±å¯ä»¥äº†

##### 1ï¼šå¯¼å…¥é«˜å¾·é…ç½®æ–‡ä»¶

![](./res/21849740e66b4c50a08ed44335f4b3cf.png)

è¯´æ˜ï¼šè¿™å—éœ€è¦å¯¼èˆªçš„jaræ–‡ä»¶ä»¥åŠå®šä½jaræ–‡ä»¶

##### 2ï¼šé…ç½®AndroidManifest.xml

>
>     <!-- è®¾ç½®talkingdataåº”ç”¨çš„appkey -->
>     <service android:name="com.amap.api.location.APSService" >
>     </service>
>  
>     <meta-data
>         android:name="com.amap.api.v2.apikey"
>         android:value="æ‚¨çš„keyæ–‡ä»¶" >
>     </meta-data>
>  

##### 3ï¼šè¿›è¡Œå¯¼èˆª

>
>     **LatLng startInfor = new
> LatLng(Double.valueOf(mAmapLocation.getLatitude()),
> mAmapLocation.getLongitude())** ;//èµ·å§‹åœ°å€
>     **LatLng endInfor = new LatLng(Double.valueOf(mallModel.getMallLat()),
> Double.valueOf(mallModel.getMallLon()))** ;//ç»ˆåˆ°åœ°å€
>     AmapNaviParams params = new AmapNaviParams(new
> Poi(mAmapLocation.getAddress(),startInfor, ""), null, new
> Poi(mallModel.getMallName(), endInfor, ""), AmapNaviType.DRIVER);
>     params.setUseInnerVoice(true);
>     AmapNaviPage.getInstance().showRouteActivity(this, params, this);

è¯´æ˜ï¼šè¿™å—çš„ä»£ç æ˜¯é«˜å¾·çš„apiæä¾›çš„ï¼›ä¸»è¦æ˜¯è°ƒèµ·å¯¼èˆªçš„åŠŸèƒ½ï¼Œåªéœ€è¦æä¾›è¿™å‡ ä¸ªå‚æ•°ä¿¡æ¯å°±å¯ä»¥äº†ï¼›

å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š

>
>     public class OrderLookActivity extends BaseActivity implements
> INaviInfoCallback, AMapLocationListener {
>  
>         // æ ‡é¢˜
>         private TextView mTvTitle;
>         // è¿”å›
>         private ImageView mIvBack;
>         private TextView mIvStu;
>         private TextView userName;
>         private TextView userPhone;
>  
>         private Button naviInfor;
>  
>         private ListView mListMessage;
>  
>         AMapLocation mAmapLocation;
>  
>         // å£°æ˜mlocationClientå¯¹è±¡
>         public AMapLocationClient mlocationClient;
>         // å£°æ˜mLocationOptionå¯¹è±¡
>         public AMapLocationClientOption mLocationOption = null;
>  
>         @Override
>         protected void onCreate(Bundle savedInstanceState) {
>             super.onCreate(savedInstanceState);
>             setContentView(R.layout.activity_order_look);
>             initWidget();
>             initData();
>             initAddress();
>         }
>  
>  
>  
>         private void initAddress() {
>  
>             try {
>                 mlocationClient = new AMapLocationClient(this);
>             } catch (Exception e) {
>                 e.printStackTrace();
>             }
>             // åˆå§‹åŒ–å®šä½å‚æ•°
>             mLocationOption = new AMapLocationClientOption();
>             // è®¾ç½®å®šä½ç›‘å¬
>             mlocationClient.setLocationListener(this);
>             // è®¾ç½®å®šä½æ¨¡å¼ä¸ºé«˜ç²¾åº¦æ¨¡å¼ï¼ŒBattery_Savingä¸ºä½åŠŸè€—æ¨¡å¼ï¼ŒDevice_Sensorsæ˜¯ä»…è®¾å¤‡æ¨¡å¼
>
> mLocationOption.setLocationMode(AMapLocationClientOption.AMapLocationMode.Device_Sensors);
>             // è®¾ç½®å®šä½é—´éš”,å•ä½æ¯«ç§’,é»˜è®¤ä¸º2000ms
>             mLocationOption.setInterval(10000);
>             mLocationOption.setOnceLocation(false);
>             //è®¾ç½®æ˜¯å¦è¿”å›åœ°å€ä¿¡æ¯ï¼ˆé»˜è®¤è¿”å›åœ°å€ä¿¡æ¯ï¼‰
>             mLocationOption.setNeedAddress(true);
>             // æ­¤æ–¹æ³•ä¸ºæ¯éš”å›ºå®šæ—¶é—´ä¼šå‘èµ·ä¸€æ¬¡å®šä½è¯·æ±‚ï¼Œä¸ºäº†å‡å°‘ç”µé‡æ¶ˆè€—æˆ–ç½‘ç»œæµé‡æ¶ˆè€—ï¼Œ
>             //
> æ³¨æ„è®¾ç½®åˆé€‚çš„å®šä½æ—¶é—´çš„é—´éš”ï¼ˆæœ€å°é—´éš”æ”¯æŒä¸º1000msï¼‰ï¼Œå¹¶ä¸”åœ¨åˆé€‚æ—¶é—´è°ƒç”¨stopLocation()æ–¹æ³•æ¥å–æ¶ˆå®šä½è¯·æ±‚
>             // åœ¨å®šä½ç»“æŸåï¼Œåœ¨åˆé€‚çš„ç”Ÿå‘½å‘¨æœŸè°ƒç”¨onDestroy()æ–¹æ³•
>             // åœ¨å•æ¬¡å®šä½æƒ…å†µä¸‹ï¼Œå®šä½æ— è®ºæˆåŠŸä¸å¦ï¼Œéƒ½æ— éœ€è°ƒç”¨stopLocation()æ–¹æ³•ç§»é™¤è¯·æ±‚ï¼Œå®šä½sdkå†…éƒ¨ä¼šç§»é™¤
>             // å¯åŠ¨å®šä½
>
> mLocationOption.setLocationPurpose(AMapLocationClientOption.AMapLocationPurpose.Sport);
>  
>             mlocationClient.setLocationOption(mLocationOption);
>             //è®¾ç½®åœºæ™¯æ¨¡å¼åæœ€å¥½è°ƒç”¨ä¸€æ¬¡stopï¼Œå†è°ƒç”¨startä»¥ä¿è¯åœºæ™¯æ¨¡å¼ç”Ÿæ•ˆ
>             mlocationClient.stopLocation();
>             mlocationClient.startLocation();
>         }
>         @Override
>         public void onClick(View v) {
>             switch (v.getId()) {
>                 case R.id.mIvBack:
>                     OrderLookActivity.this.finish();
>                     break;
>  
>                 case R.id.naviInfor:
>  
>                     LatLng startInfor = new
> LatLng(Double.valueOf(mAmapLocation.getLatitude()),
> mAmapLocation.getLongitude());//æ•…å®«åšç‰©é™¢
>                     LatLng endInfor = new
> LatLng(Double.valueOf(mallModel.getMallLat()),
> Double.valueOf(mallModel.getMallLon()));//åŒ—äº¬ç«™
>                     AmapNaviParams params = new AmapNaviParams(new
> Poi(mAmapLocation.getAddress(),startInfor, ""), null, new
> Poi(mallModel.getMallName(), endInfor, ""), AmapNaviType.DRIVER);
>                     params.setUseInnerVoice(true);
>                     AmapNaviPage.getInstance().showRouteActivity(this,
> params, this);
>                     break;
>  
>  
>             }
>         }
>  
>         @Override
>         public void initWidget() {
>  
>  
>             mListMessage = (ListView) findViewById(R.id.mListMessage);
>             userName = (TextView) findViewById(R.id.userName);
>             userPhone = (TextView) findViewById(R.id.userPhone);
>  
>  
>  
>             mIvBack = (ImageView) findViewById(R.id.mIvBack);
>             mTvTitle = (TextView) findViewById(R.id.mTvTitle);
>             mIvStu = (TextView) findViewById(R.id.mIvStu);
>             mTvTitle.setText("å•†åœºå…¬å‘Š");
>             mIvBack.setVisibility(View.VISIBLE);
>             mIvBack.setOnClickListener(this);
>             mIvStu.setOnClickListener(this);
>             mIvStu.setVisibility(View.GONE);
>             naviInfor = (Button) findViewById(R.id.naviInfor);
>             naviInfor.setOnClickListener(this);
>  
>  
>         }
>  
>         MallModel mallModel;
>  
>         @Override
>         public void initData() {
>  
>  
>             mallModel = (MallModel)
> this.getIntent().getSerializableExtra("msg");
>             userName.setText(mallModel.getMallName());
>             userPhone.setText("åœ°å€ï¼š"+mallModel.getMallAddress() + "");
>             listMessageNews(false);
>  
>  
>             mListMessage.setOnItemClickListener(new
> AdapterView.OnItemClickListener() {
>                 @Override
>                 public void onItemClick(AdapterView<?> parent, View view,
> int position, long id) {
>                     Intent intent = new Intent(OrderLookActivity.this,
> NoticeMessageActivity.class);
>                     intent.putExtra("msg", list_result.get(position));
>                     OrderLookActivity.this.startActivity(intent);
>                 }
>             });
>  
>  
>  
>         }
>  
>  
>         private void listMessageNews(boolean isShow) {
>             AjaxParams params = new AjaxParams();
>             params.put("action_flag", "listMessageNews");
>             params.put("newsMallId",mallModel.getMallId()+"");
>             httpPost(Consts.URL + Consts.APP.MessageAction, params,
> Consts.actionId.resultFlag, isShow, "æ­£åœ¨åŠ è½½...");
>         }
>  
>         private List<NewsModel> list_result = new ArrayList<NewsModel>();
>  
>         @Override
>         protected void callBackSuccess(ResponseEntry entry, int actionId) {
>             super.callBackSuccess(entry, actionId);
>  
>             switch (actionId) {
>                 case Consts.actionId.resultFlag:
>                     if (null != entry.getData() &&
> !TextUtils.isEmpty(entry.getData())) {
>  
>                         String jsonMsg = entry.getData().substring(1,
> entry.getData().length() - 1);
>                         if (null != jsonMsg && !TextUtils.isEmpty(jsonMsg))
> {
>                             list_result.clear();
>                             list_result = mGson.fromJson(entry.getData(),
> new TypeToken<List<NewsModel>>() {
>                             }.getType());
>                             NoticeAdapter noticeAdapter= new
> NoticeAdapter(this, list_result);
>                             mListMessage.setAdapter(noticeAdapter);
>                         } else {
>                         }
>                     }
>                     break;
>  
>             }
>  
>         }
>  
>  
>         @Override
>         public void onLocationChanged(AMapLocation amapLocation) {
>             if (amapLocation != null) {
>                 if (amapLocation.getErrorCode() == 0) {
>  
>                     mAmapLocation = amapLocation;
>                     // å®šä½æˆåŠŸå›è°ƒä¿¡æ¯ï¼Œè®¾ç½®ç›¸å…³æ¶ˆæ¯
>                     amapLocation.getLocationType();//
> è·å–å½“å‰å®šä½ç»“æœæ¥æºï¼Œå¦‚ç½‘ç»œå®šä½ç»“æœï¼Œè¯¦è§å®šä½ç±»å‹è¡¨
>                     amapLocation.getAccuracy();// è·å–ç²¾åº¦ä¿¡æ¯
>                     Log.i("pony_log", "è·å–å®šä½æ•°æ®ï¼š" +
> amapLocation.getAddress());
>  
>                 } else {
>                     Log.e("AmapError", "location Error, ErrCode:" +
> amapLocation.getErrorCode() + ", errInfo:" + amapLocation.getErrorInfo());
>                 }
>             }
>         }
>  
>  
>         @Override
>         public void onInitNaviFailure() {
>  
>         }
>  
>         @Override
>         public void onGetNavigationText(String s) {
>  
>         }
>  
>         @Override
>         public void onLocationChange(AMapNaviLocation aMapNaviLocation) {
>  
>         }
>  
>         @Override
>         public void onArriveDestination(boolean b) {
>  
>         }
>  
>         @Override
>         public void onStartNavi(int i) {
>  
>         }
>  
>         @Override
>         public void onCalculateRouteSuccess(int[] ints) {
>  
>         }
>  
>         @Override
>         public void onCalculateRouteFailure(int i) {
>  
>         }
>  
>         @Override
>         public void onStopSpeaking() {
>  
>         }
>  
>         @Override
>         public void onReCalculateRoute(int i) {
>  
>         }
>  
>         @Override
>         public void onExitPage(int i) {
>  
>         }
>  
>         @Override
>         public void onStrategyChanged(int i) {
>  
>         }
>  
>         @Override
>         public void onArrivedWayPoint(int i) {
>  
>         }
>  
>         @Override
>         public void onMapTypeChanged(int i) {
>  
>         }
>  
>         @Override
>         public void onNaviDirectionChanged(int i) {
>  
>         }
>  
>         @Override
>         public void onDayAndNightModeChanged(int i) {
>  
>         }
>  
>         @Override
>         public void onBroadcastModeChanged(int i) {
>  
>         }
>  
>         @Override
>         public void onScaleAutoChanged(boolean b) {
>  
>         }
>  
>         @Override
>         public View getCustomMiddleView() {
>             return null;
>         }
>  
>         @Override
>         public View getCustomNaviView() {
>             return null;
>         }
>  
>         @Override
>         public View getCustomNaviBottomView() {
>             return null;
>         }
>  
>  
>     }

**å…·ä½“é€»è¾‘æ˜¯ï¼š**

**1ï¼šé¦–å…ˆè·å–å®šä½æ•°æ®æ‹¿åˆ°å½“å‰åæ ‡å’Œå½“å‰çš„åœ°å€ä¿¡æ¯**

**2ï¼šé€šè¿‡ä¸Šä¸ªé¡µé¢ä¼ é€’çš„å€¼ä¼ é€’åˆ°éœ€è¦å¯¼èˆªçš„æ–¹æ³•é‡Œé¢å»**

**3ï¼šè¿›è¡Œå¯¼èˆª**

#### ä¸‰ã€ç•™ä¸ªè„šå°å§

> å¤§å®¶è¦æ˜¯æ„Ÿè§‰æ­¤ç¯‡æ–‡ç« æœ‰æ„ä¹‰ï¼›é‚£å°±ç»™ä¸ªå…³æ³¨ã€ç‚¹èµï¼Œæ”¶è—å§ï¼›
>
> ğŸ… **ä¹Ÿå¯ä»¥å…³æ³¨æ–‡æ¡£æœ«å°¾å…¬ä¼—å·** ğŸ…

